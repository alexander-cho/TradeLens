{% extends 'base.html' %}

{% block content %}

    <h1>{{ stock.ticker_symbol }}</h1>
    <h4>{{ stock.company_name }}</h4>

    <h5><a href="{{ url_for('options', symbol=stock.ticker_symbol) }}">Option Chain</a></h5>

    {% if not ohlcv_data.empty %}
        {% for column in ohlcv_data.columns %}
            {% if column not in ['Volume', 'Dividends', 'Stock Splits', 'Capital Gains'] %}
                {{ column }}: ${{ '%.2f'|format(ohlcv_data[column][0]) }} <br>
            {% elif column == 'Volume' %}
                {{ column }}: {{ '{:,.0f}'.format(ohlcv_data[column][0]) }} shares traded
            {% endif %}
        {% endfor %}
    {% else %}

    {% endif %}
    <br>
    {% if shares_outstanding %}
        Shares outstanding: {{ '{:,.0f}'.format(shares_outstanding) }}
    {% endif %}

    <p>
    {% if fast_info['marketCap'] %}
        Market Capitalization: {{ '${:,.0f}'.format(fast_info['marketCap']) }} <br>
    {% endif %}
    </p>


    <h3>Institutional Holdings</h3>
    {% if institutional_holders and institutional_holders|length > 0 %}
        {% for holder in institutional_holders %}
            {{ holder }} <br>
        {% endfor %}
    {% else %}
        <p>Institutional holder information is not available for {{ stock.ticker_symbol }}</p>
    {% endif %}


    <h3>Recent Insider Activity</h3>
    {% if insider_transactions %}
        {% for transaction in insider_transactions %}
            {{ transaction }} <br>
        {% endfor %}
    {% else %}
        <p>Insider activity information is not available for {{ stock.ticker_symbol }}</p>
    {% endif %}


    <h3>Earnings and Revenue Estimates</h3>
    {% if calendar %}
        {% for k, v in calendar.items() %}  <!-- earnings_forecast is of type dictionary -->
            {% if k in ['Dividend Date', 'Ex-Dividend Date'] %}  <!-- Dividend calendar -->
                {{ k }}: {{ v }} <br>
            {% elif k == 'Earnings Date' %}
                {% if v|length == 1 %}  <!-- if next earnings date is confirmed -->
                    {{ k }}: {{ v[0] }} <br>
                {% else %}
                    {{ k }}: Between {{ v[0] }} and {{ v[1] }} <br>
                {% endif %}
            {% elif k in ['Earnings High', 'Earnings Low', 'Earnings Average'] %}  <!-- EPS estimates -->
                {% if v is not none %}  <!-- if the EPS estimates information is available -->
                    {{ k }}: ${{ '{:.2f}'.format(v) }} per share <br>
                {% else %}
                    <h5>EPS estimates are not available</h5>
                {% endif %}
            {% elif k in ['Revenue High', 'Revenue Low', 'Revenue Average'] %}  <!-- Revenue estimates -->
                {% if v is not none %}  <!-- if the revenue estimates information is available -->
                    {{ k }}: {{ '${:,.0f}'.format(v) }} <br>
                {% else %}
                    <h5>Revenue estimates are not available</h5>
                {% endif %}
            {% endif %}
        {% endfor %}
    {% else %}
        Earnings and Dividend calendar not available for {{ stock.ticker_symbol }}
    {% endif %}


    <h3>Analyst Ratings</h3>
    <p>
    {% if analyst_ratings %}
        {% for firm , rating in analyst_ratings.items() %}
            {{ firm }} | {{ rating }} <br>
        {% endfor %}
    {% endif %}
    </p>


    {% include 'add_post.html' %}

    <br>
    {% for post in symbol_posts %}
        {% include '_post.html' %}
    {% endfor %}

{% endblock %}